<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metaflac Browser JS - Script Tag ç¤ºä¾‹</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 3px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        input[type="file"] {
            margin: 10px 0;
        }
        #info {
            margin-top: 10px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 3px;
        }
        #log {
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>ğŸµ Metaflac Browser JS - Script Tag ç¤ºä¾‹</h1>
    <p>è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ &lt;script&gt; æ ‡ç­¾ç›´æ¥ä½¿ç”¨ metaflac-browser-js</p>

    <div class="section">
        <h2>ğŸ“ åŠ è½½ FLAC æ–‡ä»¶</h2>
        <input type="file" id="flacFileInput" accept=".flac" />
        <div id="fileInfo"></div>
    </div>

    <div class="section">
        <h2>ğŸ“Š æ–‡ä»¶ä¿¡æ¯</h2>
        <div id="info">è¯·å…ˆé€‰æ‹©ä¸€ä¸ª FLAC æ–‡ä»¶</div>
    </div>

    <div class="section">
        <h2>ğŸ·ï¸ æ ‡ç­¾æ“ä½œ</h2>
        <div>
            <label>æ ‡ç­¾åç§°: <input type="text" id="tagName" placeholder="TITLE" /></label>
            <label>æ ‡ç­¾å€¼: <input type="text" id="tagValue" placeholder="æˆ‘çš„éŸ³ä¹" /></label>
            <button onclick="setTag()">è®¾ç½®æ ‡ç­¾</button>
            <button onclick="getTag()">è·å–æ ‡ç­¾</button>
        </div>
        <div id="tagsInfo"></div>
    </div>

    <div class="section">
        <h2>ğŸ’¾ ä¿å­˜æ–‡ä»¶</h2>
        <button id="downloadBtn" onclick="downloadFile()" disabled>ä¸‹è½½ä¿®æ”¹åçš„æ–‡ä»¶</button>
    </div>

    <div class="section">
        <h2>ğŸ“ æ“ä½œæ—¥å¿—</h2>
        <div id="log"></div>
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <!-- æ–¹å¼ä¸€ï¼šä½¿ç”¨æœ¬åœ°æ„å»ºæ–‡ä»¶ -->
    <script src="../dist/metaflac-browser-js.js"></script>
    
    <!-- æ–¹å¼äºŒï¼šä½¿ç”¨ CDNï¼ˆå‘å¸ƒåˆ° npm åå¯ç”¨ï¼‰ -->
    <!-- <script src="https://unpkg.com/metaflac-browser-js@latest/dist/metaflac-browser-js.js"></script> -->
    <!-- æˆ– -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/metaflac-browser-js@latest/dist/metaflac-browser-js.js"></script> -->

    <script>
        let flacInstance = null;

        // æ—¥å¿—å‡½æ•°
        function log(message) {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${time}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        // æ–‡ä»¶é€‰æ‹©å¤„ç†
        document.getElementById('flacFileInput').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            try {
                log(`æ­£åœ¨åŠ è½½æ–‡ä»¶: ${file.name}`);
                
                // ä½¿ç”¨å…¨å±€å˜é‡ Metaflacï¼ˆUMD æ ¼å¼ï¼‰
                flacInstance = await Metaflac.fromFile(file);
                
                log('æ–‡ä»¶åŠ è½½æˆåŠŸï¼');
                
                // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
                displayFileInfo();
                
                // æ˜¾ç¤ºæ ‡ç­¾
                displayTags();
                
                // å¯ç”¨ä¸‹è½½æŒ‰é’®
                document.getElementById('downloadBtn').disabled = false;
                
            } catch (error) {
                log(`é”™è¯¯: ${error.message}`);
                console.error(error);
            }
        });

        function displayFileInfo() {
            if (!flacInstance) return;
            
            const info = `
                <p><strong>é‡‡æ ·ç‡:</strong> ${flacInstance.getSampleRate()} Hz</p>
                <p><strong>å£°é“æ•°:</strong> ${flacInstance.getChannels()}</p>
                <p><strong>ä½æ·±åº¦:</strong> ${flacInstance.getBps()} bit</p>
                <p><strong>æ€»é‡‡æ ·æ•°:</strong> ${flacInstance.getTotalSamples()}</p>
                <p><strong>MD5:</strong> ${flacInstance.getMd5sum()}</p>
            `;
            document.getElementById('info').innerHTML = info;
        }

        function displayTags() {
            if (!flacInstance) return;
            
            const tags = flacInstance.getAllTags();
            if (tags.length === 0) {
                document.getElementById('tagsInfo').innerHTML = '<p>æ²¡æœ‰æ ‡ç­¾</p>';
                return;
            }
            
            let tagsHtml = '<ul>';
            tags.forEach(tag => {
                tagsHtml += `<li>${tag}</li>`;
            });
            tagsHtml += '</ul>';
            document.getElementById('tagsInfo').innerHTML = tagsHtml;
        }

        function setTag() {
            if (!flacInstance) {
                alert('è¯·å…ˆåŠ è½½ FLAC æ–‡ä»¶');
                return;
            }
            
            const name = document.getElementById('tagName').value.trim();
            const value = document.getElementById('tagValue').value.trim();
            
            if (!name || !value) {
                alert('è¯·è¾“å…¥æ ‡ç­¾åç§°å’Œå€¼');
                return;
            }
            
            try {
                flacInstance.setTag(`${name}=${value}`);
                log(`è®¾ç½®æ ‡ç­¾: ${name}=${value}`);
                displayTags();
            } catch (error) {
                log(`é”™è¯¯: ${error.message}`);
            }
        }

        function getTag() {
            if (!flacInstance) {
                alert('è¯·å…ˆåŠ è½½ FLAC æ–‡ä»¶');
                return;
            }
            
            const name = document.getElementById('tagName').value.trim();
            if (!name) {
                alert('è¯·è¾“å…¥æ ‡ç­¾åç§°');
                return;
            }
            
            const value = flacInstance.getTag(name);
            if (value) {
                log(`æ ‡ç­¾ ${name}: ${value}`);
                document.getElementById('tagValue').value = value.split('=')[1] || value;
            } else {
                log(`æ ‡ç­¾ ${name} ä¸å­˜åœ¨`);
            }
        }

        function downloadFile() {
            if (!flacInstance) {
                alert('è¯·å…ˆåŠ è½½ FLAC æ–‡ä»¶');
                return;
            }
            
            try {
                log('æ­£åœ¨ä¿å­˜æ–‡ä»¶...');
                const blob = flacInstance.saveAsBlob();
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'modified.flac';
                a.click();
                URL.revokeObjectURL(url);
                log('æ–‡ä»¶ä¸‹è½½å®Œæˆ');
            } catch (error) {
                log(`é”™è¯¯: ${error.message}`);
            }
        }

        // æ£€æŸ¥ Metaflac æ˜¯å¦å·²åŠ è½½
        if (typeof Metaflac === 'undefined') {
            log('é”™è¯¯: Metaflac æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥è„šæœ¬è·¯å¾„');
        } else {
            log('Metaflac å·²åŠ è½½ï¼Œå¯ä»¥ä½¿ç”¨äº†ï¼');
        }
    </script>
</body>
</html>

